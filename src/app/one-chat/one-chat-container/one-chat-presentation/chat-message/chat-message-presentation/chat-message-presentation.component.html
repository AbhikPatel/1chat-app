<!-- Start: User Message  -->
<div
    class="main-chat-container h-100 d-flex flex-column overflow-hidden border-bottom border-primary border-3 position-relative">
    <ng-container *ngIf="receiversConversation else gif">
        <!-- Floating Label  -->
        <div class="floating-btn position-absolute rounded-circle d-flex justify-content-center align-items-center shadow-lg"
            role="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight"
            *ngIf="userRole === 'intern'">
            <span class="fs-4 text-white"> + </span>
        </div>
        <!-- Start: Header Section  -->
        <div id="header" class="d-flex">
            <div class="container d-flex align-items-center justify-content-between ">
                <div class="d-flex align-items-center h-100">
                    <div class="d-flex align-items-center">
                        <figure class="m-0">
                            <img [src]="receiversConversation.profile" class="rounded-circle shadow border profile-img"
                                alt="profile">
                        </figure>
                        <div class="ms-3 d-flex flex-column">
                            <!-- <span class="fw-semibold"> {{getReceiverData?.full_name}} </span>
                        <ng-container *ngIf="showTyping | async else status">
                            <span [ngClass]="(showTyping | async) ? 'visible' : 'invisible'" class="fs-8"> Typing... </span>
                        </ng-container>
                        <ng-template #status>
                            <span class="fs-7"> {{showStatus ? 'Online' : 'Offline'}} </span>
                        </ng-template> -->
                            <span class="fw-semibold"> {{receiversConversation.displayName}} </span>
                            <div class="fs-7"
                                *ngIf="typingIds.includes(receiversConversation.members[0]._id) && showTypingText | async else online">
                                Typing </div>
                            <ng-container *ngIf="groupTyperNames.length !== 0">
                                <span class="fs-7">{{groupTyperNames.join(', ') + ' is typing'}}</span>
                            </ng-container>
                            <ng-template #online>
                                <span class="fs-7"> Online </span>
                            </ng-template>
                        </div>
                    </div>

                    <!-- Tab view  -->
                    <div class="d-flex h-100 px-4">
                        <span class="h-100 border-3 border-success d-flex align-items-center mx-2"
                            (click)="onWindow(true)" role="button"
                            [ngClass]="{'border-bottom fw-semibold' : currentWindow}"> Chat </span>
                        <span class="h-100 border-3 border-success d-flex align-items-center mx-2"
                            (click)="onWindow(false)" role="button"
                            [ngClass]="{'border-bottom fw-semibold' : !currentWindow}"> EOD </span>
                    </div>
                </div>

                <!-- Group functionality -->
                <div class="d-flex" *ngIf="receiversConversation.chat_type === 'group'">
                    <span role="button" class="icon icon-bxs-user-plus fs-3" title="View group members"
                        (click)="viewMembers()"></span>
                </div>
            </div>
        </div>

        <!-- End: Header Section  -->

        <!-- Start: EOD Form  -->
        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" data-bs-backdrop="static"
            aria-labelledby="offcanvasRightLabel">
            <div class="offcanvas-header d-flex justify-content-center">
                <h5 class="offcanvas-title" id="offcanvasRightLabel"> Eod Report </h5>
            </div>
            <div class="offcanvas-body position-relative">

                <!-- Start: EOD Report Summary -->
                <div class="eod-container bg-white position-absolute shadow h-100 py-4"
                    [ngClass]="showEODSummary ? 'eod-open' : 'eod-close'">
                    <div class="d-flex justify-content-between align-items-center pb-3">
                        <div>
                            <span class="fw-bold"> Name: </span>
                            <span> {{senderName}} </span>
                        </div>
                        <div>
                            <span class="fw-bold"> Date: </span>
                            <span> {{eodDate}} </span>
                        </div>
                    </div>
                    <div class="table-container pb-3">
                        <table class="w-100">
                            <thead>
                                <tr>
                                    <th> Task </th>
                                    <th> Hours </th>
                                    <th> Description </th>
                                    <th> Blocker </th>
                                    <th> Status </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let task of allTasks">
                                    <td> {{task.name}} </td>
                                    <td> {{task.hours}} </td>
                                    <td> {{task.description}} </td>
                                    <td> {{task.blocker || '-'}} </td>
                                    <td [ngClass]="task.type.className"> {{task.type.displayName}} </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- EOD Summary buttons  -->
                    <div class="d-flex justify-content-between align-items-center">
                        <button class="btn btn-danger text-white" type="button" (click)="backToEod()"> Edit Eod
                        </button>
                        <button class="btn btn-success text-white" type="button" data-bs-toggle="offcanvas"
                            data-bs-target="#offcanvasRight" aria-controls="offcanvasRight" (click)="onEodSubmit()">
                            Submit
                        </button>
                    </div>
                </div>
                <!-- End: EOD Report Summary -->

                <!-- Start: Accordion  -->
                <div class="accordion" id="accordionExample">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingOne">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                In Progress tasks
                            </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionExample"
                            aria-labelledby="headingOne">
                            <div class="accordion-body">
                                <!-- Start: EOD Form  -->
                                <form [formGroup]="eodFormGroup">
                                    <div class="border p-4 border-1 rounded-3 my-3 position-relative"
                                        formArrayName="InProgress"
                                        *ngFor="let m of this.formTaskArray('InProgress').controls; let i = index">

                                        <!-- Delete Task button  -->
                                        <div class="model-close-btn position-absolute"
                                            (click)="onDeleteTask(i, 'InProgress')">
                                            <button class="btn-close" type="button"></button>
                                        </div>

                                        <ng-container [formGroupName]="i">
                                            <div class="row g-4">
                                                <!-- Task Title  -->
                                                <div class="col-6">
                                                    <label for="title" class="form-label required"> Task Title</label>
                                                    <input type="text" class="form-control" name="title" id="title"
                                                        formControlName="name">
                                                </div>

                                                <!-- Work Hours  -->
                                                <div class="col-6">
                                                    <label for="hours" class="form-label required">Work Hours</label>
                                                    <input type="number" class="form-control" name="hours" id="hours"
                                                        formControlName="hours">
                                                </div>

                                                <!-- Description  -->
                                                <div class="col-12">
                                                    <label for="description"
                                                        class="form-label required">Description</label>
                                                    <textarea name="description" id="description" cols="30" rows="8"
                                                        class="form-control" formControlName="description"></textarea>
                                                </div>

                                                <!-- Blocker  -->
                                                <div class="col-12">
                                                    <label for="blocker" class="form-label"> Blocker </label>
                                                    <input type="text" class="form-control" name="blocker" id="blocker"
                                                        formControlName="blocker">
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>
                                </form>
                                <button class="btn btn-primary w-100 mt-3" type="button"
                                    [disabled]="eodFormGroup.get('InProgress').invalid"
                                    (click)="onAddTask('InProgress')">
                                    + Add Task </button>
                                <!-- End: EOD Form  -->
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingTwo">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                Completed Tasks
                            </button>
                        </h2>
                        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                            data-bs-parent="#accordionExample">
                            <div class="accordion-body">

                                <!-- Start: EOD Form  -->
                                <form [formGroup]="eodFormGroup">
                                    <div class="border p-4 border-1 rounded-3 my-3 position-relative"
                                        formArrayName="completed"
                                        *ngFor="let m of this.formTaskArray('completed').controls; let i = index">
                                        <div class="model-close-btn position-absolute"
                                            (click)="onDeleteTask(i, 'completed')">
                                            <button class="btn-close" type="button"></button>
                                        </div>
                                        <ng-container [formGroupName]="i">
                                            <div class="row g-4">

                                                <!-- Task Title  -->
                                                <div class="col-6">
                                                    <label for="title" class="form-label required">Task Title</label>
                                                    <input type="text" class="form-control" name="title" id="title"
                                                        formControlName="name">
                                                </div>

                                                <!-- Work Hours  -->
                                                <div class="col-6">
                                                    <label for="hours" class="form-label required">Work Hours</label>
                                                    <input type="number" class="form-control" name="hours" id="hours"
                                                        formControlName="hours">
                                                </div>

                                                <!-- Description  -->
                                                <div class="col-12">
                                                    <label for="description"
                                                        class="form-label required">Description</label>
                                                    <textarea name="description" id="description" cols="30" rows="8"
                                                        class="form-control" formControlName="description"></textarea>
                                                </div>

                                                <!-- Blocker  -->
                                                <div class="col-12">
                                                    <label for="blocker" class="form-label"> Blocker </label>
                                                    <input type="text" class="form-control" name="blocker" id="blocker"
                                                        formControlName="blocker">
                                                </div>

                                            </div>
                                        </ng-container>
                                    </div>
                                </form>
                                <button class="btn btn-primary w-100 mt-3"
                                    [disabled]="eodFormGroup.get('completed').invalid" (click)="onAddTask('completed')">
                                    + Add
                                    Task
                                </button>
                                <!-- End: EOD Form  -->

                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingThree">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                New Learning
                            </button>
                        </h2>
                        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree"
                            data-bs-parent="#accordionExample">
                            <div class="accordion-body">

                                <!-- Start: EOD Form  -->
                                <form [formGroup]="eodFormGroup">
                                    <div class="border border-1 p-4 rounded-3 my-3 position-relative"
                                        formArrayName="newLearning"
                                        *ngFor="let m of this.formTaskArray('newLearning').controls; let i = index">
                                        <div class="model-close-btn position-absolute"
                                            (click)="onDeleteTask(i, 'newLearning')">
                                            <button class="btn-close" type="button"></button>
                                        </div>
                                        <ng-container [formGroupName]="i">
                                            <div class="row g-4">

                                                <!-- Task Title  -->
                                                <div class="col-6">
                                                    <label for="title" class="form-label required">Task Title</label>
                                                    <input type="text" class="form-control" name="title" id="title"
                                                        formControlName="name">
                                                </div>

                                                <!-- Work Hours  -->
                                                <div class="col-6">
                                                    <label for="hours" class="form-label required">Work Hours</label>
                                                    <input type="number" class="form-control" name="hours" id="hours"
                                                        formControlName="hours">
                                                </div>

                                                <!-- Description  -->
                                                <div class="col-12">
                                                    <label for="description" class="form-label"> Description </label>
                                                    <textarea name="description" id="description" cols="30" rows="8"
                                                        class="form-control" formControlName="description"></textarea>
                                                </div>

                                                <!-- Blocker  -->
                                                <div class="col-12">
                                                    <label for="blocker" class="form-label"> Blocker </label>
                                                    <input type="text" class="form-control" name="blocker" id="blocker"
                                                        formControlName="blocker">
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>
                                </form>
                                <button class="btn btn-primary w-100 mt-3"
                                    [disabled]="eodFormGroup.get('newLearning').invalid"
                                    (click)="onAddTask('newLearning')">
                                    +
                                    Add Task
                                </button>
                                <!-- End: EOD Form  -->

                            </div>
                        </div>
                    </div>
                </div>
                <!-- End: Accordion  -->

                <div class="d-flex justify-content-between pt-3">
                    <button class="btn btn-danger text-white" type="button" data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasRight" aria-controls="offcanvasRight" (click)="onCancel()"> Cancel
                    </button>
                    <button class="btn btn-success text-white" type="submit" [disabled]="!eodFormGroup.valid"
                        (click)="onEodSummary()"> Submit
                    </button>
                </div>
            </div>
        </div>
        <!-- End: EOD Form  -->

        <!-- Start: Chat Screen -->
        <div class="flex-grow-1 overflow-hidden position-relative">

            <!-- Group Members Modal  -->
            <div class="members-modal position-absolute shadow-lg py-2 rounded-1 bg-white top-0 end-0"
                *ngIf="receiversConversation.chat_type === 'group' && showMembersModal">
                <ul class="list-unstyled m-0">
                    <li class="d-flex align-items-center px-3 py-2"
                        *ngFor="let members of receiversConversation.members">
                        <figure class="m-0">
                            <img [src]="members.photo" alt="avatar" class="rounded-circle shadow profile-img">
                        </figure>
                        <span class="ps-3"> {{members.full_name}} </span>
                    </li>
                </ul>
            </div>

            <!-- Chatting  -->
            <ng-container *ngIf="currentWindow else eod">
                <app-chatting-presentation [chatArray]="chatArray" [senderId]="senderId"
                    (chatData)="getChatData($event)" (InputTyping)="getInputTyping()"
                    (editMessageObj)="getEditMessageObj($event)" (repliedMessage)="getRepliedMessage($event)"
                    [receiversConversation]="receiversConversation"></app-chatting-presentation>
            </ng-container>

            <!-- Eod Status Reaport  -->
            <ng-template #eod>
                <app-eod-presentation [getEodDetails]="eodReportDetails"
                    [getReports]="getReports"></app-eod-presentation>
            </ng-template>
        </div>
        <!-- End: Chat Screen -->

    </ng-container>

    <!-- If no conversation started message -->
    <ng-template #gif>
        <div class="d-flex flex-column h-100 justify-content-center align-items-center">
            <figure>
                <img src="assets/icons/981-consultation-lineal.gif" alt="user-conversation-image"
                    class="w-75">
            </figure>
            <h4 class="text-center"> Select any user to start the conversation </h4>
        </div>
    </ng-template>
</div>
<!-- End: User Message -->